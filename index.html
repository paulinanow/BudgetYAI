<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BudgetYAI - AI-Powered Personal Finance Dashboard</title>
    <meta name="description" content="Upload your bank statements, get AI-powered categorization, and receive personalized budget recommendations with BudgetYAI.">
    
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts via CDN -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.min.js"></script>
    
    <!-- Lucide Icons via CDN -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- PapaParse via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2; }
        .btn-secondary { @apply bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2; }
        .card { @apply bg-white rounded-xl shadow-sm border border-gray-200 p-6; }
        .input-field { @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent; }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div id="app">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-600 p-2 rounded-lg">
                            <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">BudgetYAI</h1>
                            <p class="text-sm text-gray-600">AI-Powered Personal Finance Dashboard</p>
                        </div>
                    </div>
                    
                    <button id="resetBtn" class="flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors duration-200" title="Reset and upload new data">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span class="hidden sm:inline">Reset</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Upload View -->
            <div id="uploadView" class="max-w-2xl mx-auto">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">Welcome to BudgetYAI</h1>
                    <p class="text-xl text-gray-600 mb-8">Upload your bank statement CSV to get AI-powered insights and personalized budget recommendations</p>
                </div>

                <div class="card">
                    <div class="text-center mb-6">
                        <svg class="h-16 w-16 text-blue-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <h2 class="text-2xl font-semibold text-gray-900 mb-2">Upload Your Bank Statement</h2>
                        <p class="text-gray-600">Drag and drop your CSV file here, or click to browse</p>
                    </div>

                    <div id="dropZone" class="border-2 border-dashed border-gray-300 hover:border-blue-400 rounded-lg p-8 text-center transition-colors duration-200">
                        <input type="file" accept=".csv" id="fileInput" class="hidden">
                        <label for="fileInput" class="cursor-pointer block">
                            <svg class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-900 mb-2" id="uploadText">Choose CSV file or drag here</p>
                            <p class="text-sm text-gray-500">Supports standard bank statement formats</p>
                        </label>
                    </div>

                    <div id="errorMessage" class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 hidden">
                        <svg class="h-5 w-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-red-700" id="errorText"></span>
                    </div>

                    <div class="mt-6 text-center">
                        <button id="downloadSampleBtn" class="btn-secondary inline-flex items-center space-x-2">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>Download Sample CSV</span>
                        </button>
                    </div>

                    <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 class="font-medium text-blue-900 mb-2">Expected CSV Format:</h3>
                        <ul class="text-sm text-blue-800 space-y-1">
                            <li>â€¢ Date column (YYYY-MM-DD format)</li>
                            <li>â€¢ Description column (transaction details)</li>
                            <li>â€¢ Amount column (positive for income, negative for expenses)</li>
                            <li>â€¢ Optional: Category column (will be enhanced by AI)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboardView" class="hidden space-y-8">
                <div class="flex items-center justify-between">
                    <h1 class="text-3xl font-bold text-gray-900">Your Financial Dashboard</h1>
                    <button id="uploadNewBtn" class="btn-secondary">Upload New Data</button>
                </div>
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="summaryCards">
                    <!-- Cards will be populated dynamically -->
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Spending by Category</h3>
                        <div id="pieChart" class="h-80"></div>
                    </div>
                    
                    <div class="card">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Monthly Trends</h3>
                        <div id="lineChart" class="h-80"></div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Transactions</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="transactionsTable">
                                <!-- Transactions will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- AI Recommendations and Savings -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card" id="aiRecommendations">
                        <!-- AI recommendations will be populated dynamically -->
                    </div>
                    
                    <div class="card" id="savingsOpportunities">
                        <!-- Savings opportunities will be populated dynamically -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global state
        let transactions = [];
        let categorizedTransactions = [];
        let budgetMetrics = null;
        let aiRecommendations = null;

        // DOM elements
        const uploadView = document.getElementById('uploadView');
        const dashboardView = document.getElementById('dashboardView');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadText = document.getElementById('uploadText');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const resetBtn = document.getElementById('resetBtn');
        const uploadNewBtn = document.getElementById('uploadNewBtn');
        const downloadSampleBtn = document.getElementById('downloadSampleBtn');

        // Event listeners
        resetBtn.addEventListener('click', resetData);
        uploadNewBtn.addEventListener('click', () => showView('upload'));
        downloadSampleBtn.addEventListener('click', downloadSampleCSV);
        
        // File upload handling
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        // Drag and drop handlers
        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('border-blue-400', 'bg-blue-50');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('border-blue-400', 'bg-blue-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        // File processing
        function processFile(file) {
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showError('Please upload a CSV file');
                return;
            }

            uploadText.textContent = 'Processing...';
            
            Papa.parse(file, {
                complete: (results) => {
                    if (results.errors.length > 0) {
                        showError('Error parsing CSV file. Please check the format.');
                        return;
                    }
                    
                    if (results.data.length === 0) {
                        showError('CSV file is empty');
                        return;
                    }

                    handleCSVUpload(results.data);
                },
                header: true,
                skipEmptyLines: true,
                error: (error) => {
                    showError('Error reading CSV file: ' + error.message);
                }
            });
        }

        // CSV upload handler
        async function handleCSVUpload(csvData) {
            try {
                const processedData = processCSVData(csvData);
                transactions = processedData;
                
                // Categorize transactions using AI
                categorizedTransactions = await categorizeTransactions(processedData);
                
                // Calculate budget metrics
                budgetMetrics = calculateBudgetMetrics(categorizedTransactions);
                
                // Generate AI recommendations
                aiRecommendations = await generateAIRecommendations(categorizedTransactions, budgetMetrics);
                
                showView('dashboard');
                renderDashboard();
            } catch (error) {
                console.error('Error processing CSV:', error);
                showError('Error processing CSV file. Please check the format and try again.');
            } finally {
                uploadText.textContent = 'Choose CSV file or drag here';
            }
        }

        // CSV data processing
        function processCSVData(csvData) {
            return csvData
                .filter(row => row && Object.keys(row).length > 0)
                .map(row => {
                    const standardizedRow = {};
                    
                    if (row.Date || row.date || row.DATE) {
                        standardizedRow.date = row.Date || row.date || row.DATE;
                    }
                    if (row.Description || row.description || row.DESC || row.desc) {
                        standardizedRow.description = row.Description || row.description || row.DESC || row.desc;
                    }
                    if (row.Amount || row.amount || row.AMOUNT) {
                        standardizedRow.amount = row.Amount || row.amount || row.AMOUNT;
                    }
                    if (row.Category || row.category || row.CAT || row.cat) {
                        standardizedRow.category = row.Category || row.category || row.CAT || row.cat;
                    }
                    
                    if (standardizedRow.date) {
                        const date = new Date(standardizedRow.date);
                        if (!isNaN(date.getTime())) {
                            standardizedRow.date = date.toISOString().split('T')[0];
                        }
                    }
                    
                    if (standardizedRow.amount) {
                        const cleanAmount = standardizedRow.amount.toString().replace(/[$,]/g, '');
                        standardizedRow.amount = parseFloat(cleanAmount);
                    }
                    
                    if (standardizedRow.description) {
                        standardizedRow.description = standardizedRow.description.toString().trim();
                    }
                    
                    return standardizedRow;
                })
                .filter(row => 
                    row.date && 
                    row.description && 
                    !isNaN(row.amount) && 
                    row.amount !== 0
                );
        }

        // AI categorization (simulated)
        async function categorizeTransactions(transactions) {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const categories = {
                'Food & Dining': ['restaurant', 'cafe', 'food', 'dining', 'meal', 'grocery', 'supermarket', 'market', 'bakery', 'coffee', 'starbucks'],
                'Transportation': ['gas', 'fuel', 'uber', 'lyft', 'taxi', 'parking', 'toll', 'metro', 'subway', 'bus', 'train', 'airline', 'flight'],
                'Entertainment': ['netflix', 'spotify', 'hulu', 'amazon prime', 'youtube', 'movie', 'cinema', 'theater', 'concert', 'show', 'game'],
                'Shopping': ['amazon', 'walmart', 'target', 'costco', 'best buy', 'clothing', 'shoes', 'apparel', 'electronics'],
                'Utilities': ['electric', 'electricity', 'gas', 'water', 'internet', 'cable', 'phone', 'utility'],
                'Healthcare': ['doctor', 'hospital', 'medical', 'pharmacy', 'drug', 'medicine', 'prescription'],
                'Education': ['school', 'college', 'university', 'tuition', 'fee', 'book', 'textbook'],
                'Housing': ['rent', 'mortgage', 'home', 'house', 'apartment', 'condo', 'property'],
                'Personal Care': ['haircut', 'salon', 'spa', 'massage', 'beauty', 'gym', 'fitness', 'workout'],
                'Travel': ['hotel', 'lodging', 'vacation', 'trip', 'journey', 'tour', 'cruise', 'resort']
            };
            
            return transactions.map(transaction => {
                const description = (transaction.description || '').toLowerCase();
                const amount = parseFloat(transaction.amount) || 0;
                
                let bestCategory = 'Uncategorized';
                let bestScore = 0;
                
                for (const [category, keywords] of Object.entries(categories)) {
                    let score = 0;
                    for (const keyword of keywords) {
                        if (description.includes(keyword)) {
                            score += 1;
                        }
                    }
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestCategory = category;
                    }
                }
                
                if (amount > 0) {
                    bestCategory = 'Income';
                }
                
                return {
                    ...transaction,
                    category: bestCategory,
                    confidence: bestScore > 0 ? Math.min(0.9, 0.5 + (bestScore * 0.1)) : 0.3
                };
            });
        }

        // Budget metrics calculation
        function calculateBudgetMetrics(transactions) {
            const totalIncome = transactions
                .filter(t => parseFloat(t.amount) > 0)
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);

            const totalExpenses = transactions
                .filter(t => parseFloat(t.amount) < 0)
                .reduce((sum, t) => sum + Math.abs(parseFloat(t.amount)), 0);

            const netSavings = totalIncome - totalExpenses;
            const savingsRate = totalIncome > 0 ? (netSavings / totalIncome) * 100 : 0;

            return {
                totalIncome,
                totalExpenses,
                netSavings,
                savingsRate,
                transactionCount: transactions.length
            };
        }

        // AI recommendations (simulated)
        async function generateAIRecommendations(transactions, budgetMetrics) {
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const { totalIncome, totalExpenses, savingsRate } = budgetMetrics;
            
            const budgetRule = [
                {
                    name: 'Needs (50%)',
                    target: totalIncome * 0.5,
                    actual: Math.min(totalExpenses, totalIncome * 0.5),
                    percentage: 50,
                    status: totalExpenses <= totalIncome * 0.5 ? 'good' : 'danger'
                },
                {
                    name: 'Wants (30%)',
                    target: totalIncome * 0.3,
                    actual: Math.max(0, totalExpenses - totalIncome * 0.5),
                    percentage: 30,
                    status: totalExpenses <= totalIncome * 0.8 ? 'good' : 'warning'
                },
                {
                    name: 'Savings (20%)',
                    target: totalIncome * 0.2,
                    actual: Math.max(0, totalIncome - totalExpenses),
                    percentage: 20,
                    status: (totalIncome - totalExpenses) >= totalIncome * 0.2 ? 'good' : 'warning'
                }
            ];
            
            const suggestions = [];
            if (savingsRate < 10) {
                suggestions.push({
                    title: 'Low Savings Rate',
                    description: `Your savings rate is ${savingsRate.toFixed(1)}%, below the recommended 10-20%.`,
                    potentialSavings: totalIncome * 0.1
                });
            }
            
            return { budgetRule, suggestions };
        }

        // Dashboard rendering
        function renderDashboard() {
            renderSummaryCards();
            renderCharts();
            renderTransactionsTable();
            renderAIRecommendations();
            renderSavingsOpportunities();
        }

        function renderSummaryCards() {
            const { totalIncome, totalExpenses, netSavings, transactionCount } = budgetMetrics;
            
            const summaryCards = document.getElementById('summaryCards');
            summaryCards.innerHTML = `
                <div class="card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Income</p>
                            <p class="text-2xl font-bold text-green-600">
                                $${totalIncome.toLocaleString('en-US', { minimumFractionDigits: 2 })}
                            </p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Expenses</p>
                            <p class="text-2xl font-bold text-red-600">
                                $${totalExpenses.toLocaleString('en-US', { minimumFractionDigits: 2 })}
                            </p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-lg">
                            <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Net Savings</p>
                            <p class="text-2xl font-bold ${netSavings >= 0 ? 'text-green-600' : 'text-red-600'}">
                                $${netSavings.toLocaleString('en-US', { minimumFractionDigits: 2 })}
                            </p>
                        </div>
                        <div class="p-3 rounded-lg ${netSavings >= 0 ? 'bg-green-100' : 'bg-red-100'}">
                            <svg class="h-6 w-6 ${netSavings >= 0 ? 'text-green-600' : 'text-red-600'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Transactions</p>
                            <p class="text-2xl font-bold text-gray-900">
                                ${transactionCount}
                            </p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCharts() {
            // Simple chart rendering (you can enhance this with Recharts)
            const pieChart = document.getElementById('pieChart');
            const lineChart = document.getElementById('lineChart');
            
            pieChart.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Chart visualization would appear here with Recharts</div>';
            lineChart.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Chart visualization would appear here with Recharts</div>';
        }

        function renderTransactionsTable() {
            const tbody = document.getElementById('transactionsTable');
            const recentTransactions = categorizedTransactions.slice(0, 10);
            
            tbody.innerHTML = recentTransactions.map(transaction => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${new Date(transaction.date).toLocaleDateString()}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${transaction.description}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${transaction.category || 'Uncategorized'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${
                        parseFloat(transaction.amount) >= 0 ? 'text-green-600' : 'text-red-600'
                    }">
                        ${parseFloat(transaction.amount) >= 0 ? '+' : ''}$${parseFloat(transaction.amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}
                    </td>
                </tr>
            `).join('');
        }

        function renderAIRecommendations() {
            const container = document.getElementById('aiRecommendations');
            
            if (!aiRecommendations) {
                container.innerHTML = '<div class="text-center py-8"><p class="text-gray-500">AI recommendations will appear here after processing your data</p></div>';
                return;
            }

            const { budgetRule, suggestions } = aiRecommendations;
            
            container.innerHTML = `
                <div class="flex items-center space-x-3 mb-6">
                    <div class="bg-blue-100 p-2 rounded-lg">
                        <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900">AI Budget Recommendations</h3>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-medium text-gray-900 mb-3 flex items-center space-x-2">
                        <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>50/30/20 Budget Rule Analysis</span>
                    </h4>
                    
                    <div class="space-y-3">
                        ${budgetRule.map(category => `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 rounded-full ${
                                        category.status === 'good' ? 'bg-green-500' :
                                        category.status === 'warning' ? 'bg-yellow-500' : 'bg-red-500'
                                    }"></div>
                                    <span class="font-medium text-gray-700">${category.name}</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">
                                        ${category.percentage}% of income
                                    </div>
                                    <div class="text-sm font-medium text-gray-900">
                                        $${category.amount.toLocaleString('en-US', { minimumFractionDigits: 2 })}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-medium text-gray-900 mb-3 flex items-center space-x-2">
                        <svg class="h-5 w-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        <span>Smart Suggestions</span>
                    </h4>
                    
                    <div class="space-y-3">
                        ${suggestions.map(suggestion => `
                            <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <svg class="h-5 w-5 text-green-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <div>
                                        <p class="font-medium text-green-900">${suggestion.title}</p>
                                        <p class="text-sm text-green-700">${suggestion.description}</p>
                                        ${suggestion.potentialSavings ? `
                                            <p class="text-sm font-medium text-green-800 mt-1">
                                                Potential savings: $${suggestion.potentialSavings.toLocaleString('en-US', { minimumFractionDigits: 2 })}/month
                                            </p>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderSavingsOpportunities() {
            const container = document.getElementById('savingsOpportunities');
            
            if (!categorizedTransactions.length) {
                container.innerHTML = '<div class="text-center py-8"><p class="text-gray-500">Savings analysis will appear here after processing your data</p></div>';
                return;
            }

            // Calculate savings opportunities
            const categorySpending = categorizedTransactions.reduce((acc, transaction) => {
                if (parseFloat(transaction.amount) < 0) {
                    const category = transaction.category || 'Uncategorized';
                    const amount = Math.abs(parseFloat(transaction.amount));
                    
                    if (acc[category]) {
                        acc[category].total += amount;
                        acc[category].count += 1;
                    } else {
                        acc[category] = { total: amount, count: 1 };
                    }
                }
                return acc;
            }, {});

            const highSpendingCategories = Object.entries(categorySpending)
                .filter(([, data]) => data.total > 100)
                .sort(([, a], [, b]) => b.total - a.total)
                .slice(0, 3);

            const potentialSavings = highSpendingCategories.reduce((total, [, data]) => {
                return total + (data.total * 0.2);
            }, 0);

            container.innerHTML = `
                <div class="flex items-center space-x-3 mb-6">
                    <div class="bg-green-100 p-2 rounded-lg">
                        <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900">Savings Opportunities</h3>
                </div>

                <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-green-700">Potential Monthly Savings</p>
                            <p class="text-2xl font-bold text-green-900">
                                $${potentialSavings.toLocaleString('en-US', { minimumFractionDigits: 2 })}
                            </p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-sm text-green-600 mt-2">
                        Based on 20% reduction potential in high-spending categories
                    </p>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-medium text-gray-900 mb-3 flex items-center space-x-2">
                        <svg class="h-5 w-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                        </svg>
                        <span>High-Spending Categories</span>
                    </h4>
                    
                    <div class="space-y-3">
                        ${highSpendingCategories.map(([category, data]) => `
                            <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-red-900">${category}</p>
                                        <p class="text-sm text-red-700">
                                            ${data.count} transactions
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-lg font-bold text-red-900">
                                            $${data.total.toLocaleString('en-US', { minimumFractionDigits: 2 })}
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="mt-3 p-2 bg-white rounded border border-red-100">
                                    <p class="text-sm text-red-800">
                                        ðŸ’¡ Potential savings: $${(data.total * 0.2).toLocaleString('en-US', { minimumFractionDigits: 2 })}/month
                                    </p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Utility functions
        function showView(view) {
            if (view === 'upload') {
                uploadView.classList.remove('hidden');
                dashboardView.classList.add('hidden');
            } else {
                uploadView.classList.add('hidden');
                dashboardView.classList.remove('hidden');
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }

        function resetData() {
            transactions = [];
            categorizedTransactions = [];
            budgetMetrics = null;
            aiRecommendations = null;
            showView('upload');
            fileInput.value = '';
            uploadText.textContent = 'Choose CSV file or drag here';
        }

        function downloadSampleCSV() {
            const sampleData = [
                { Date: '2024-01-01', Description: 'Grocery Store', Amount: '-45.67', Category: 'Food & Dining' },
                { Date: '2024-01-02', Description: 'Gas Station', Amount: '-32.50', Category: 'Transportation' },
                { Date: '2024-01-03', Description: 'Salary Deposit', Amount: '2500.00', Category: 'Income' },
                { Date: '2024-01-04', Description: 'Netflix Subscription', Amount: '-15.99', Category: 'Entertainment' },
                { Date: '2024-01-05', Description: 'Restaurant', Amount: '-67.89', Category: 'Food & Dining' },
                { Date: '2024-01-06', Description: 'Electric Bill', Amount: '-89.45', Category: 'Utilities' },
                { Date: '2024-01-07', Description: 'Amazon Purchase', Amount: '-23.99', Category: 'Shopping' },
                { Date: '2024-01-08', Description: 'Gas Station', Amount: '-28.75', Category: 'Transportation' },
                { Date: '2024-01-09', Description: 'Coffee Shop', Amount: '-4.50', Category: 'Food & Dining' },
                { Date: '2024-01-10', Description: 'Movie Theater', Amount: '-12.99', Category: 'Entertainment' }
            ];
            
            const csv = Papa.unparse(sampleData);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample-transactions.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize the app
        console.log('BudgetYAI loaded successfully!');
    </script>
</body>
</html>
